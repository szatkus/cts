{"version":3,"sources":["../../../src/suites/unittests/getStackTrace.spec.ts"],"names":["description","TestGroup","getStackTrace","UnitTest","g","test","t","lines","params","_expectedLines","ex","Error","stack","_stack","expect","stringified","parts","split","length","every","p","indexOf","case"],"mappings":";;;;AAAA,OAAO,MAAMA,WAAW,GAAI;;CAArB;AAIP,SAASC,SAAT,EAAoBC,aAApB,QAAyC,0BAAzC;AAEA,SAASC,QAAT,QAAyB,gBAAzB;AAEA,OAAO,MAAMC,CAAC,GAAG,IAAIH,SAAJ,CAAcE,QAAd,CAAV;AAEPC,CAAC,CAACC,IAAF,CAAO,QAAP,EAAiBC,CAAC,IAAI;AACpB,QAAMC,KAAa,GAAGD,CAAC,CAACE,MAAF,CAASC,cAA/B;AAEA,QAAMC,EAAE,GAAG,IAAIC,KAAJ,EAAX;AACAD,EAAAA,EAAE,CAACE,KAAH,GAAWN,CAAC,CAACE,MAAF,CAASK,MAApB;AACAP,EAAAA,CAAC,CAACQ,MAAF,CAASJ,EAAE,CAACE,KAAH,KAAaN,CAAC,CAACE,MAAF,CAASK,MAA/B;AACA,QAAME,WAAW,GAAGb,aAAa,CAACQ,EAAD,CAAjC;AACA,QAAMM,KAAK,GAAGD,WAAW,CAACE,KAAZ,CAAkB,IAAlB,CAAd;AAEAX,EAAAA,CAAC,CAACQ,MAAF,CAASE,KAAK,CAACE,MAAN,KAAiBX,KAA1B;AACAD,EAAAA,CAAC,CAACQ,MAAF,CAASE,KAAK,CAACG,KAAN,CAAYC,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,UAAV,MAA0B,CAAC,CAA5C,CAAT;AACD,CAXD,EAWGb,MAXH,CAWU,CACR;AACEc,EAAAA,IAAI,EAAE,WADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;AAHX,CADQ,EAUR;AACES,EAAAA,IAAI,EAAE,YADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;AAHX,CAVQ,EAkBR;AACES,EAAAA,IAAI,EAAE,cADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;AAHX,CAlBQ,EA0BR;AACES,EAAAA,IAAI,EAAE,eADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;AAHX,CA1BQ,EAgCR;AACES,EAAAA,IAAI,EAAE,aADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;;;AAHX,CAhCQ,EA2CR;AACES,EAAAA,IAAI,EAAE,cADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;AAHX,CA3CQ,EAoDR;AACES,EAAAA,IAAI,EAAE,aADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;;;AAHX,CApDQ,EA+DR;AACES,EAAAA,IAAI,EAAE,cADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;;;;;AAHX,CA/DQ,EA4ER;AACES,EAAAA,IAAI,EAAE,gBADR;AAEEb,EAAAA,cAAc,EAAE,CAFlB;AAGEI,EAAAA,MAAM,EAAG;;;;;;;;;;;AAHX,CA5EQ,CAXV","sourcesContent":["export const description = `\nTests for getStackTrace.\n`;\n\nimport { TestGroup, getStackTrace } from '../../framework/index.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = new TestGroup(UnitTest);\n\ng.test('stacks', t => {\n  const lines: number = t.params._expectedLines;\n\n  const ex = new Error();\n  ex.stack = t.params._stack;\n  t.expect(ex.stack === t.params._stack);\n  const stringified = getStackTrace(ex);\n  const parts = stringified.split('\\n');\n\n  t.expect(parts.length === lines);\n  t.expect(parts.every(p => p.indexOf('/suites/') !== -1));\n}).params([\n  {\n    case: 'node_fail',\n    _expectedLines: 1,\n    _stack: `Error:\n   at CaseRecorder.fail (/Users/kainino/src/cts-experiment/src/framework/logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/logger.spec.ts:80:7)\n   at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n   at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n  },\n  {\n    case: 'node_throw',\n    _expectedLines: 1,\n    _stack: `Error: hello\n    at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts-experiment/src/suites/unittests/test_group.spec.ts:51:11)\n    at RunCaseSpecific.run (/Users/kainino/src/cts-experiment/src/framework/test_group.ts:121:18)\n    at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n  },\n  {\n    case: 'firefox_fail',\n    _expectedLines: 1,\n    _stack: `fail@http://localhost:8080/out/framework/logger.js:104:30\nexpect@http://localhost:8080/out/framework/default_fixture.js:59:16\n@http://localhost:8080/out/suites/unittests/util.spec.js:35:5\nrun@http://localhost:8080/out/framework/test_group.js:119:18`,\n  },\n  {\n    case: 'firefox_throw',\n    _expectedLines: 1,\n    _stack: `@http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11\nrun@http://localhost:8080/out/framework/test_group.js:119:18`,\n  },\n  {\n    case: 'safari_fail',\n    _expectedLines: 1,\n    _stack: `fail@http://localhost:8080/out/framework/logger.js:104:39\nexpect@http://localhost:8080/out/framework/default_fixture.js:59:20\nhttp://localhost:8080/out/suites/unittests/util.spec.js:35:11\nhttp://localhost:8080/out/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n  },\n  {\n    case: 'safari_throw',\n    _expectedLines: 1,\n    _stack: `http://localhost:8080/out/suites/unittests/test_group.spec.js:48:20\nhttp://localhost:8080/out/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n  },\n  {\n    case: 'chrome_fail',\n    _expectedLines: 1,\n    _stack: `Error\n    at CaseRecorder.fail (http://localhost:8080/out/framework/logger.js:104:30)\n    at DefaultFixture.expect (http://localhost:8080/out/framework/default_fixture.js:59:16)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/util.spec.js:35:5)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n  {\n    case: 'chrome_throw',\n    _expectedLines: 1,\n    _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/suites/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n  {\n    case: 'multiple_lines',\n    _expectedLines: 3,\n    _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/suites/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/suites/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/runtime/standalone.js:102:7`,\n  },\n]);\n"],"file":"getStackTrace.spec.js"}