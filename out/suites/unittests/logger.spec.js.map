{"version":3,"sources":["../../../src/suites/unittests/logger.spec.ts"],"names":["description","SkipTestCase","TestGroup","paramsEquals","Logger","UnitTest","g","test","t","mylog","testrec","testres","record","suite","path","res1","params2","res2","expect","spec","cases","length","params","logs","undefined","status","timems","res","a","_b","rec","start","finish","debug","Error","skipped","warn","fail","_logsCount"],"mappings":";;;;AAAA,OAAO,MAAMA,WAAW,GAAI;;;;CAArB;AAMP,SAASC,YAAT,EAAuBC,SAAvB,EAAkCC,YAAlC,QAAsD,0BAAtD;AACA,SAASC,MAAT,QAAuB,2BAAvB;AAEA,SAASC,QAAT,QAAyB,gBAAzB;AAEA,OAAO,MAAMC,CAAC,GAAG,IAAIJ,SAAJ,CAAcG,QAAd,CAAV;AAEPC,CAAC,CAACC,IAAF,CAAO,WAAP,EAAoBC,CAAC,IAAI;AACvB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,EAAUC,OAAV,IAAqBF,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,GAAT;AAAcC,IAAAA,IAAI,EAAE;AAApB,GAAb,CAA3B;AACA,QAAM,GAAGC,IAAH,IAAWL,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAjB;AACA,QAAMI,OAAO,GAAG,EAAhB;AACA,QAAM,GAAGC,IAAH,IAAWP,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsBI,OAAtB,CAAjB;AAEAR,EAAAA,CAAC,CAACU,MAAF,CAASP,OAAO,CAACQ,IAAR,KAAiB,YAA1B;AACAX,EAAAA,CAAC,CAACU,MAAF,CAASP,OAAO,CAACS,KAAR,CAAcC,MAAd,KAAyB,CAAlC;AACAb,EAAAA,CAAC,CAACU,MAAF,CAASP,OAAO,CAACS,KAAR,CAAc,CAAd,MAAqBL,IAA9B;AACAP,EAAAA,CAAC,CAACU,MAAF,CAASP,OAAO,CAACS,KAAR,CAAc,CAAd,MAAqBH,IAA9B;AACAT,EAAAA,CAAC,CAACU,MAAF,CAASH,IAAI,CAACR,IAAL,KAAc,KAAvB;AACAC,EAAAA,CAAC,CAACU,MAAF,CAASH,IAAI,CAACO,MAAL,KAAgB,IAAzB;AACAd,EAAAA,CAAC,CAACU,MAAF,CAASH,IAAI,CAACQ,IAAL,KAAcC,SAAvB;AACAhB,EAAAA,CAAC,CAACU,MAAF,CAASH,IAAI,CAACU,MAAL,KAAgB,SAAzB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASH,IAAI,CAACW,MAAL,GAAc,CAAvB;AACAlB,EAAAA,CAAC,CAACU,MAAF,CAASD,IAAI,CAACV,IAAL,KAAc,KAAvB;AACAC,EAAAA,CAAC,CAACU,MAAF,CAASf,YAAY,CAACc,IAAI,CAACK,MAAN,EAAcN,OAAd,CAArB;AACAR,EAAAA,CAAC,CAACU,MAAF,CAASD,IAAI,CAACM,IAAL,KAAcC,SAAvB;AACAhB,EAAAA,CAAC,CAACU,MAAF,CAASD,IAAI,CAACQ,MAAL,KAAgB,SAAzB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASD,IAAI,CAACS,MAAL,GAAc,CAAvB;AACD,CArBD;AAuBApB,CAAC,CAACC,IAAF,CAAO,gBAAP,EAAyBC,CAAC,IAAI;AAC5B,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,GAAT;AAAcC,IAAAA,IAAI,EAAE;AAApB,GAAb,CAAlB;AACA,QAAM,GAAGa,GAAH,IAAUjB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB;AAAEgB,IAAAA,CAAC,EAAE,CAAL;AAAQC,IAAAA,EAAE,EAAE;AAAZ,GAAtB,CAAhB;AAEArB,EAAAA,CAAC,CAACU,MAAF,CAASf,YAAY,CAACwB,GAAG,CAACL,MAAL,EAAa;AAAEM,IAAAA,CAAC,EAAE;AAAL,GAAb,CAArB;AACD,CAND;AAQAtB,CAAC,CAACC,IAAF,CAAO,OAAP,EAAgBC,CAAC,IAAI;AACnB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ;AACAvB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AACAK,EAAAA,GAAG,CAACE,MAAJ;AACAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACD,CAVD;AAYApB,CAAC,CAACC,IAAF,CAAO,MAAP,EAAeC,CAAC,IAAI;AAClB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ;AACAD,EAAAA,GAAG,CAACG,KAAJ,CAAU,IAAIC,KAAJ,CAAU,OAAV,CAAV;AACA1B,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AACAK,EAAAA,GAAG,CAACE,MAAJ;AACAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACD,CAXD;AAaApB,CAAC,CAACC,IAAF,CAAO,MAAP,EAAeC,CAAC,IAAI;AAClB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ;AACAvB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AAEAK,EAAAA,GAAG,CAACK,OAAJ,CAAY,IAAIlC,YAAJ,EAAZ;AACA6B,EAAAA,GAAG,CAACG,KAAJ,CAAU,IAAIC,KAAJ,CAAU,OAAV,CAAV;AAEA1B,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AACAK,EAAAA,GAAG,CAACE,MAAJ;AAEAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACD,CAhBD;AAkBApB,CAAC,CAACC,IAAF,CAAO,MAAP,EAAeC,CAAC,IAAI;AAClB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ;AACAvB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AAEAK,EAAAA,GAAG,CAACM,IAAJ,CAAS,IAAIF,KAAJ,EAAT;AACAJ,EAAAA,GAAG,CAACK,OAAJ,CAAY,IAAIlC,YAAJ,EAAZ;AAEAO,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AACAK,EAAAA,GAAG,CAACE,MAAJ;AAEAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACD,CAhBD;AAkBApB,CAAC,CAACC,IAAF,CAAO,MAAP,EAAeC,CAAC,IAAI;AAClB,QAAMC,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ;AACAvB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AAEAK,EAAAA,GAAG,CAACO,IAAJ,CAAS,IAAIH,KAAJ,CAAU,KAAV,CAAT;AACAJ,EAAAA,GAAG,CAACM,IAAJ,CAAS,IAAIF,KAAJ,EAAT;AACAJ,EAAAA,GAAG,CAACK,OAAJ,CAAY,IAAIlC,YAAJ,EAAZ;AAEAO,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,SAAxB;AACAK,EAAAA,GAAG,CAACE,MAAJ;AAEAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACD,CAjBD;AAmBApB,CAAC,CAACC,IAAF,CAAO,OAAP,EAAgBC,CAAC,IAAI;AACnB,QAAM;AAAEyB,IAAAA,KAAF;AAASK,IAAAA;AAAT,MAAwB9B,CAAC,CAACc,MAAhC;AAEA,QAAMb,KAAK,GAAG,IAAIL,MAAJ,EAAd;AACA,QAAM,CAACM,OAAD,IAAYD,KAAK,CAACG,MAAN,CAAa;AAAEC,IAAAA,KAAK,EAAE,EAAT;AAAaC,IAAAA,IAAI,EAAE;AAAnB,GAAb,CAAlB;AACA,QAAM,CAACgB,GAAD,EAAMH,GAAN,IAAajB,OAAO,CAACE,MAAR,CAAe,KAAf,EAAsB,IAAtB,CAAnB;AAEAkB,EAAAA,GAAG,CAACC,KAAJ,CAAUE,KAAV;AACAH,EAAAA,GAAG,CAACG,KAAJ,CAAU,IAAIC,KAAJ,CAAU,OAAV,CAAV;AACAJ,EAAAA,GAAG,CAACE,MAAJ;AACAxB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACF,MAAJ,KAAe,MAAxB;AACAjB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACD,MAAJ,IAAc,CAAvB;AACAlB,EAAAA,CAAC,CAACU,MAAF,CAASS,GAAG,CAACJ,IAAJ,CAAUF,MAAV,KAAqBiB,UAA9B;AACD,CAbD,EAaGhB,MAbH,CAaU,CACR;AAAEW,EAAAA,KAAK,EAAE,IAAT;AAAeK,EAAAA,UAAU,EAAE;AAA3B,CADQ,EACwB;AAChC;AAAEL,EAAAA,KAAK,EAAE,KAAT;AAAgBK,EAAAA,UAAU,EAAE;AAA5B,CAFQ,CAbV","sourcesContent":["export const description = `\nUnit tests for namespaced logging system.\n\nAlso serves as a larger test of async test functions, and of the logging system.\n`;\n\nimport { SkipTestCase, TestGroup, paramsEquals } from '../../framework/index.js';\nimport { Logger } from '../../framework/logger.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = new TestGroup(UnitTest);\n\ng.test('construct', t => {\n  const mylog = new Logger();\n  const [testrec, testres] = mylog.record({ suite: 'a', path: 'foo/bar' });\n  const [, res1] = testrec.record('baz', null);\n  const params2 = {};\n  const [, res2] = testrec.record('qux', params2);\n\n  t.expect(testres.spec === 'a:foo/bar:');\n  t.expect(testres.cases.length === 2);\n  t.expect(testres.cases[0] === res1);\n  t.expect(testres.cases[1] === res2);\n  t.expect(res1.test === 'baz');\n  t.expect(res1.params === null);\n  t.expect(res1.logs === undefined);\n  t.expect(res1.status === 'running');\n  t.expect(res1.timems < 0);\n  t.expect(res2.test === 'qux');\n  t.expect(paramsEquals(res2.params, params2));\n  t.expect(res2.logs === undefined);\n  t.expect(res2.status === 'running');\n  t.expect(res2.timems < 0);\n});\n\ng.test('private params', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: 'a', path: 'foo/bar' });\n  const [, res] = testrec.record('baz', { a: 1, _b: 2 });\n\n  t.expect(paramsEquals(res.params, { a: 1 }));\n});\n\ng.test('empty', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n  rec.finish();\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('pass', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  rec.debug(new Error('hello'));\n  t.expect(res.status === 'running');\n  rec.finish();\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('skip', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.skipped(new SkipTestCase());\n  rec.debug(new Error('hello'));\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'skip');\n  t.expect(res.timems >= 0);\n});\n\ng.test('warn', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'warn');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail', t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.fail(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('debug', t => {\n  const { debug, _logsCount } = t.params;\n\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start(debug);\n  rec.debug(new Error('hello'));\n  rec.finish();\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n  t.expect(res.logs!.length === _logsCount);\n}).params([\n  { debug: true, _logsCount: 1 }, //\n  { debug: false, _logsCount: 0 },\n]);\n"],"file":"logger.spec.js"}